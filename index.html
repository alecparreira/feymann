<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interativo: Construindo o Aprendiz de Feynman</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: Uma SPA (Single-Page Application) com navega√ß√£o por scroll-spy que guia o utilizador atrav√©s dos conceitos do relat√≥rio. A estrutura foi desenhada para ser uma jornada de aprendizagem, come√ßando com os princ√≠pios fundamentais ("A Constitui√ß√£o"), movendo-se para o processo central ("O Ciclo Interativo"), aprofundando a l√≥gica ("A Matriz de Questionamento") e culminando numa demonstra√ß√£o pr√°tica ("Simulador de Di√°logo"). Esta abordagem transforma um documento est√°tico numa ferramenta explor√°vel, onde o utilizador interage com cada conceito, o que facilita a compreens√£o de um sistema complexo ao inv√©s de apenas ler sobre ele. -->
    <!-- Visualization & Content Choices:
        - Report Info: Regras de Ouro -> Goal: Informar -> Viz/Presentation: Cart√µes interativos com √≠cones (HTML/CSS) -> Interaction: Clique para expandir e ver detalhes -> Justification: Torna os princ√≠pios densos mais diger√≠veis e visualmente apelativos.
        - Report Info: Ciclo de 5 Fases -> Goal: Organizar/Explicar Processo -> Viz/Presentation: Diagrama de fluxo vertical interativo (HTML/CSS) -> Interaction: Clicar num passo revela a sua descri√ß√£o detalhada -> Justification: Visualiza o processo de forma clara e permite uma explora√ß√£o passo a passo no ritmo do utilizador.
        - Report Info: Matriz de Questionamento -> Goal: Relacionar/Comparar -> Viz/Presentation: Tabela interativa (HTML) -> Interaction: Hover na linha para destacar e ver a conex√£o entre gatilho, racioc√≠nio e pergunta -> Justification: Conecta dinamicamente a teoria (gatilho) com a pr√°tica (pergunta exemplo), clarificando a l√≥gica do Gem.
        - Report Info: Cen√°rios Avan√ßados e Estudo de Caso -> Goal: Demonstrar/Aplicar -> Viz/Presentation: Abas interativas e um simulador de chat (HTML/CSS/JS) -> Interaction: Clicar para alternar cen√°rios; clicar em bot√µes para avan√ßar o di√°logo simulado -> Justification: Oferece uma prova de conceito tang√≠vel, mostrando a IA em a√ß√£o e como ela lida com situa√ß√µes complexas.
        - Library/Method: Apenas Vanilla JS e Tailwind CSS para toda a interatividade e estiliza√ß√£o.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .nav-link.active {
            color: #D35400;
            font-weight: 700;
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
        .step.active div:first-child {
            background-color: #D35400;
            color: white;
        }
        .step.active p {
            font-weight: 700;
            color: #D35400;
        }
        #chat-window .gemini-typing-indicator {
            align-items: center;
            display: flex;
            padding-top: 0.5rem;
        }
        #chat-window .gemini-typing-indicator span {
            animation: bounce 1s infinite;
            background-color: #D35400;
            border-radius: 50%;
            display: inline-block;
            height: 8px;
            margin: 0 2px;
            width: 8px;
        }
        #chat-window .gemini-typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        #chat-window .gemini-typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-[#D35400]">Aprendiz de Feynman</h1>
            <div class="hidden md:flex space-x-8">
                <a href="#constituicao" class="nav-link text-gray-600 hover:text-[#D35400] transition">A Constitui√ß√£o</a>
                <a href="#ciclo" class="nav-link text-gray-600 hover:text-[#D35400] transition">O Ciclo</a>
                <a href="#assistente" class="nav-link text-gray-600 hover:text-[#D35400] transition">‚ú® Assistente</a>
                <a href="#simulador" class="nav-link text-gray-600 hover:text-[#D35400] transition">Simulador ao Vivo</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <!-- Introduction -->
        <section class="text-center mb-24">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Construindo um Tutor de IA Socr√°tico</h2>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                Este guia interativo destrincha o "Relat√≥rio de Design do Aprendiz de Feynman". Explore os princ√≠pios, o fluxo de conversa√ß√£o e a l√≥gica que permitem a uma IA for√ßar o aprendizado profundo atrav√©s da T√©cnica de Feynman. Agora com o poder da API do Gemini!
            </p>
        </section>

        <!-- Section 1: The Constitution -->
        <section id="constituicao" class="mb-24 scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">A Constitui√ß√£o do Gem</h3>
            <p class="text-center text-gray-600 mb-12">Os princ√≠pios e regras imut√°veis que governam o comportamento do "Aprendiz de Feynman".</p>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="card bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h4 class="text-xl font-bold mb-3">üìú Persona: Aluno Curioso</h4>
                    <p class="text-gray-600">O Gem incorpora um aluno inteligente, mas totalmente ignorante sobre o tema, for√ßando o utilizador a ser o "Professor". Sua curiosidade √© a ferramenta pedag√≥gica central.</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h4 class="text-xl font-bold mb-3">ü•á Primazia da Ignor√¢ncia</h4>
                    <p class="text-gray-600">Regra de ouro n¬∫ 1: O Gem nunca fornece respostas diretas. Ele reflete as perguntas de volta, for√ßando o utilizador a ser a √∫nica fonte de conhecimento.</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h4 class="text-xl font-bold mb-3">üîÅ Manuten√ß√£o da Persona</h4>
                    <p class="text-gray-600">A din√¢mica Professor-Aluno √© perp√©tua. O feedback √© sempre enquadrado como uma falha de compreens√£o do Gem, n√£o uma cr√≠tica ao utilizador.</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h4 class="text-xl font-bold mb-3">‚ùì Foco no "Porqu√™" e "Como"</h4>
                    <p class="text-gray-600">As perguntas transcendem "o qu√™" para investigar ativamente os mecanismos, as causas e os efeitos por tr√°s das afirma√ß√µes do utilizador.</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h4 class="text-xl font-bold mb-3">üëç Refor√ßo Positivo Estrat√©gico</h4>
                    <p class="text-gray-600">Elogia um ponto forte da explica√ß√£o antes de questionar um ponto fraco. Isso diminui a defensividade e mant√©m o utilizador engajado no processo.</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h4 class="text-xl font-bold mb-3">üîé Ca√ßa Ativa ao Jarg√£o</h4>
                    <p class="text-gray-600">Qualquer termo t√©cnico n√£o explicado em linguagem simples √© um alvo priorit√°rio para uma pergunta de clarifica√ß√£o.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: The Cycle -->
        <section id="ciclo" class="mb-24 scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">O Ciclo de Feynman em A√ß√£o</h3>
            <p class="text-center text-gray-600 mb-12">A intera√ß√£o √© um ciclo iterativo. Clique em cada fase para entender o seu papel no processo de aprendizagem.</p>

            <div class="flex flex-col md:flex-row gap-8 lg:gap-12">
                <!-- Vertical Stepper -->
                <div class="w-full md:w-1/3">
                    <div class="space-y-4">
                        <div class="step active cursor-pointer" onclick="showStep(1)">
                            <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center font-bold text-lg transition">1</div>
                            <p class="mt-2 text-lg font-medium text-gray-700 transition">Inicia√ß√£o</p>
                        </div>
                         <div class="step cursor-pointer" onclick="showStep(2)">
                            <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center font-bold text-lg transition">2</div>
                            <p class="mt-2 text-lg font-medium text-gray-700 transition">Primeira Explica√ß√£o</p>
                        </div>
                         <div class="step cursor-pointer" onclick="showStep(3)">
                            <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center font-bold text-lg transition">3</div>
                            <p class="mt-2 text-lg font-medium text-gray-700 transition">An√°lise e Pergunta</p>
                        </div>
                         <div class="step cursor-pointer" onclick="showStep(4)">
                            <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center font-bold text-lg transition">4</div>
                            <p class="mt-2 text-lg font-medium text-gray-700 transition">Revis√£o e Refinamento</p>
                        </div>
                        <div class="step cursor-pointer" onclick="showStep(5)">
                            <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center font-bold text-lg transition">5</div>
                            <p class="mt-2 text-lg font-medium text-gray-700 transition">Consolida√ß√£o</p>
                        </div>
                    </div>
                </div>
                <!-- Step Content -->
                <div class="w-full md:w-2/3 bg-white p-8 rounded-lg shadow-md border border-gray-200">
                    <div id="step-1" class="step-content active">
                        <h4 class="text-2xl font-bold mb-4">Fase 1: Inicia√ß√£o da Sess√£o</h4>
                        <p class="text-gray-700 mb-4">O Gem apresenta-se como "Aluno Curioso" e estabelece as regras, definindo o utilizador como "Professor". Esta fase enquadra a intera√ß√£o e define as expectativas.</p>
                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <p class="font-mono text-sm text-orange-800">"Ol√°! A sua miss√£o, 'Professor', √© explicar-me um conceito √† sua escolha de forma t√£o clara que at√© eu consiga entender. Qual √© o conceito que gostaria de me ensinar hoje?"</p>
                        </div>
                    </div>
                     <div id="step-2" class="step-content">
                        <h4 class="text-2xl font-bold mb-4">Fase 2: A Primeira Explica√ß√£o</h4>
                        <p class="text-gray-700 mb-4">O utilizador fornece a sua explica√ß√£o inicial. O Gem permanece em "an√°lise ativa", identificando silenciosamente jarg√µes, saltos l√≥gicos e lacunas, sem interromper o fluxo de pensamento do utilizador.</p>
                         <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <p class="font-mono text-sm text-blue-800">"Fant√°stico! Estou pronto e ansioso para aprender. Por favor, explique-me isto como se eu tivesse 5 anos. Estou a ouvir atentamente."</p>
                        </div>
                    </div>
                    <div id="step-3" class="step-content">
                        <h4 class="text-2xl font-bold mb-4">Fase 3: An√°lise Cr√≠tica e Gera√ß√£o de Perguntas</h4>
                        <p class="text-gray-700 mb-4">A fase central. Com base na an√°lise, o Gem formula perguntas direcionadas aos pontos fracos, sempre usando o refor√ßo positivo primeiro para manter o utilizador engajado.</p>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <p class="font-mono text-sm text-green-800">"Professor, que legal! As analogias ajudam demais! Mas... e quando voc√™ falou de 'desvio √† esquerda', o que √© isso?"</p>
                        </div>
                    </div>
                    <div id="step-4" class="step-content">
                        <h4 class="text-2xl font-bold mb-4">Fase 4: Revis√£o e Aprofundamento</h4>
                        <p class="text-gray-700 mb-4">O utilizador √© for√ßado a refinar a sua explica√ß√£o. O Gem ent√£o refraseia o conceito em termos simples para confirmar o entendimento. Este passo valida o progresso e solidifica o modelo mental.</p>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <p class="font-mono text-sm text-purple-800">"Ah, perfeito! Ent√£o, o 'desvio √† esquerda' √© como um sinal de alarme, a 'f√°brica' envia at√© os 'recrutas' mais jovens para a batalha. √â isso mesmo?"</p>
                        </div>
                    </div>
                     <div id="step-5" class="step-content">
                        <h4 class="text-2xl font-bold mb-4">Fase 5: Consolida√ß√£o e Encerramento</h4>
                        <p class="text-gray-700 mb-4">O Gem incentiva o utilizador a recitar ou reescrever a explica√ß√£o completa e refinada. Este ato de recupera√ß√£o ativa √© um dos mecanismos mais poderosos para a memoriza√ß√£o a longo prazo.</p>
                         <div class="bg-gray-100 p-4 rounded-lg border border-gray-200">
                            <p class="font-mono text-sm text-gray-800">"Sinto que agora entendo mesmo! Para garantir que o conhecimento est√° s√≥lido, que tal dar a aula completa de novo, do in√≠cio ao fim?"</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Professor's Assistant -->
        <section id="assistente" class="mb-24 scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">‚ú® Assistente do Professor</h3>
            <p class="text-center text-gray-600 mb-12">Ficou bloqueado? Use a IA para o ajudar a refinar os seus pensamentos antes de os ensinar.</p>
            <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md border border-gray-200">
                <label for="assistant-input" class="block text-lg font-medium text-gray-700 mb-2">Insira o seu conceito ou explica√ß√£o aqui:</label>
                <textarea id="assistant-input" rows="4" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#D35400] focus:border-[#D35400]" placeholder="Ex: A mitoc√¥ndria √© a casa de for√ßa da c√©lula..."></textarea>
                <div class="flex flex-col sm:flex-row gap-4 mt-4">
                    <button id="simplify-btn" class="flex-1 bg-[#D35400] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#E67E22] transition shadow-md">‚ú® Simplificar Conceito</button>
                    <button id="generate-questions-btn" class="flex-1 bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition shadow-md">‚ú® Gerar Perguntas</button>
                </div>
                <div id="assistant-output" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px]">
                    <p class="text-gray-500">Os resultados aparecer√£o aqui...</p>
                </div>
            </div>
        </section>

        <!-- Section 4: Live Simulator -->
        <section id="simulador" class="scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">Simulador de Di√°logo ao Vivo</h3>
            <p class="text-center text-gray-600 mb-12">Assuma o papel de "Professor". Ensine um conceito √† IA e veja como ela responde em tempo real.</p>

            <div class="max-w-3xl mx-auto">
                <div id="chat-window" class="bg-white rounded-t-lg shadow-lg border border-gray-200 p-4 h-96 overflow-y-auto space-y-4">
                    <!-- Chat messages will be appended here -->
                </div>
                <div class="bg-white rounded-b-lg shadow-lg border-t-0 border border-gray-200 p-4">
                    <form id="chat-form" class="flex gap-4">
                        <input type="text" id="chat-input" class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#D35400] focus:border-[#D35400]" placeholder="Comece a ensinar..." autocomplete="off">
                        <button type="submit" class="bg-[#D35400] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#E67E22] transition shadow-md">Enviar</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-100 border-t border-gray-200 mt-24">
        <div class="container mx-auto px-6 py-8 text-center text-gray-500">
            <p>Guia Interativo baseado no "Relat√≥rio de Design Detalhado: Constru√ß√£o do Gem 'Aprendiz de Feynman'".</p>
            <p class="text-sm mt-2">Uma aplica√ß√£o para explorar a intersec√ß√£o da pedagogia e da IA.</p>
        </div>
    </footer>

<script>
    // Navigation scroll spy
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');

    window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            if (pageYOffset >= sectionTop - 80) {
                current = section.getAttribute('id');
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href').includes(current)) {
                link.classList.add('active');
            }
        });
    });

    // Interactive Cycle Stepper
    const steps = document.querySelectorAll('.step');
    const stepContents = document.querySelectorAll('.step-content');

    function showStep(stepNumber) {
        steps.forEach(step => step.classList.remove('active'));
        stepContents.forEach(content => content.classList.remove('active'));

        document.querySelector(`.step:nth-child(${stepNumber})`).classList.add('active');
        document.getElementById(`step-${stepNumber}`).classList.add('active');
    }

    // Gemini API Integration
    const apiKey = ""; // API key is handled by the environment
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${AIzaSyDeXRGnLh8F63nEeDFBjYveJSnjKkMNbRA}`;

    // Professor's Assistant
    const assistantInput = document.getElementById('assistant-input');
    const simplifyBtn = document.getElementById('simplify-btn');
    const generateQuestionsBtn = document.getElementById('generate-questions-btn');
    const assistantOutput = document.getElementById('assistant-output');

    async function callGemini(prompt) {
        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }]
        };
        try {
            const response = await fetch(apiUrl, {/.netlify/functions/call-gemini
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const result = await response.json();
             if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                return "Desculpe, n√£o consegui processar a sua resposta. A estrutura da resposta da API era inesperada.";
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return "Desculpe, ocorreu um erro ao comunicar com a IA. Por favor, tente novamente mais tarde.";
        }
    }

    simplifyBtn.addEventListener('click', async () => {
        const inputText = assistantInput.value.trim();
        if (!inputText) {
            assistantOutput.innerHTML = '<p class="text-red-500">Por favor, insira um conceito para simplificar.</p>';
            return;
        }
        assistantOutput.innerHTML = '<p class="text-gray-500">A simplificar... ‚ú®</p>';
        const prompt = `Simplifique o seguinte conceito como se estivesse a explicar a uma crian√ßa de 5 anos, usando analogias simples. N√£o use jarg√µes. Conceito: "${inputText}"`;
        const result = await callGemini(prompt);
        assistantOutput.innerHTML = `<p>${result.replace(/\n/g, '<br>')}</p>`;
    });

    generateQuestionsBtn.addEventListener('click', async () => {
        const inputText = assistantInput.value.trim();
        if (!inputText) {
            assistantOutput.innerHTML = '<p class="text-red-500">Por favor, insira uma explica√ß√£o para gerar perguntas.</p>';
            return;
        }
        assistantOutput.innerHTML = '<p class="text-gray-500">A gerar perguntas... ‚ú®</p>';
        const prompt = `Aja como um tutor usando a T√©cnica de Feynman. Leia a seguinte afirma√ß√£o e gere 3 perguntas socr√°ticas que investiguem os pontos fracos, jarg√µes ou lacunas l√≥gicas. Afirma√ß√£o: "${inputText}"`;
        const result = await callGemini(prompt);
        assistantOutput.innerHTML = `<p>${result.replace(/\n/g, '<br>')}</p>`;
    });

    // Live Chat Simulator
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatWindow = document.getElementById('chat-window');
    let conversationHistory = [];

    const feynmanConstitution = `Voc√™ √© o "Aprendiz de Feynman", um aluno curioso e inteligente, mas totalmente ignorante sobre o tema. Seu objetivo √© for√ßar o "Professor" (o usu√°rio) a explicar um conceito de forma simples. Siga estas regras rigorosamente:
1.  **Primazia da Ignor√¢ncia:** Nunca forne√ßa respostas diretas ou conhecimento externo. Reflita as perguntas de volta.
2.  **Manuten√ß√£o da Persona:** Voc√™ √© sempre o aluno. Se o professor errar, a culpa √© da sua "falta de entendimento".
3.  **Foco no "Porqu√™" e "Como":** Investigue os mecanismos por tr√°s das afirma√ß√µes.
4.  **Refor√ßo Positivo Estrat√©gico:** Elogie um ponto forte antes de questionar um ponto fraco.
5.  **Ca√ßa Ativa ao Jarg√£o:** Qualquer termo t√©cnico n√£o explicado √© um alvo para uma pergunta.
6.  **Seja conciso:** Mantenha as suas respostas curtas e diretas.`;

    function appendMessage(sender, text) {
        const messageElement = document.createElement('div');
        if (sender === 'user') {
            messageElement.innerHTML = `
                <div class="flex items-start gap-3 justify-end">
                    <div class="bg-blue-100 p-3 rounded-lg text-gray-700 max-w-md">${text}</div>
                    <span class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold flex-shrink-0">P</span>
                </div>`;
            conversationHistory.push({ role: "user", parts: [{ text }] });
        } else { // gemini
            messageElement.innerHTML = `
                <div class="flex items-start gap-3">
                    <span class="w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold flex-shrink-0">ü§ñ</span>
                    <div class="bg-orange-100 p-3 rounded-lg text-gray-700 max-w-md">${text}</div>
                </div>`;
            conversationHistory.push({ role: "model", parts: [{ text }] });
        }
        chatWindow.appendChild(messageElement);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function showTypingIndicator() {/.netlify/functions/call-gemini
        const typingElement = document.createElement('div');
        typingElement.id = 'typing-indicator';
        typingElement.classList.add('gemini-typing-indicator');
        typingElement.innerHTML = `
            <div class="flex items-start gap-3">
                <span class="w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold flex-shrink-0">ü§ñ</span>
                <div class="bg-orange-100 p-3 rounded-lg">
                    <div class="flex space-x-1">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            </div>`;
        chatWindow.appendChild(typingElement);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function removeTypingIndicator() {
        const typingElement = document.getElementById('typing-indicator');
        if (typingElement) {
            typingElement.remove();
        }
    }
    
    appendMessage('gemini', 'Ol√°, Professor! Que conceito fascinante vamos explorar hoje?');

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const userInput = chatInput.value.trim();
        if (!userInput) return;

        appendMessage('user', userInput);
        chatInput.value = '';
        showTypingIndicator();

        const prompt = `${feynmanConstitution}\n\nHist√≥rico da Conversa:\n${conversationHistory.map(m => `${m.role === 'user' ? 'Professor' : 'Aluno'}: ${m.parts[0].text}`).join('\n')}\n\nProfessor: ${userInput}\nAluno:`;
        
        const payload = {
            contents: [...conversationHistory],
            systemInstruction: {
                parts: [{ text: feynmanConstitution }]
            }
        };

        try {
            const response = await fetch(apiUrl, {/.netlify/functions/call-gemini
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
             if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const result = await response.json();
            removeTypingIndicator();
            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                const geminiResponse = result.candidates[0].content.parts[0].text;
                appendMessage('gemini', geminiResponse);
            } else {
                 console.error("Unexpected API response structure:", result);
                appendMessage('gemini', "Desculpe, n√£o consegui processar a sua resposta. A estrutura da resposta da API era inesperada.");
            }
        } catch (error) {
            removeTypingIndicator();
            console.error("Error calling Gemini API for chat:", error);
            appendMessage('gemini', "Desculpe, ocorreu um erro. Por favor, tente novamente.");
        }
    });

</script>

</body>
</html>
